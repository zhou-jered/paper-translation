# 摘要
今天给你介绍mesos，这是一个在各种各样的集群计算框架之间共享集群的平台，比如说 Hadoop 和 MPI，这里说的的共享指的是提升利用率和避免在不同计算框架之间复制数据，让框架通过轮流读取存储在本地机器上的数据达到数据本地性（Locality）。为了支持当今框架复杂的调度实现，Mesos 提出了一个分布式的两阶段调度机制叫做 resource offers。Mesos 决定每个框架需要多少 resources，同时框架自己决定接受哪些 resources 和 运行怎样的计算，我们的结果显示 Mesos 在不同框架之间分享集群资源就快要达到最优的数据本地性（Locality），且可以扩展到5w个node（emulated 模拟），且具备失败弹性恢复。

# 简介
现在的计算平台基本上都是商业机器集群，为庞大的联网服务和快速增长的计算任务提供支持。在程序猿在努力下，发展起来的很多的计算框架来简化集群的操作，比如 MapReduce，Dryad，MapReduce Online 和其他框架。

可以预见的是，新的计算框架肯定会持续的出现，没有框架会适合所有类型的应用程序（app）。所以，你的老板想要在一个集群里面跑起来所有的框架，你要负责选择出最合适的框架来运行你的 app。在框架之间复用集群可以显而易见的避免复制数据的消耗，从而来提高利用率。
两个比较常见的解决方案是，1，静态的划分集群资源分片，每个分片跑一个框架。2，给每个框架分配一些虚拟机。抱歉，这些方案即不能提升机器利用率也不能提高数据效率。这里面的主要问题是资源分配粒度和框架之间的错配。现有的框架，比如 Hadoop 和 Dryad，引入了一个细粒度的资源共享模型，就是把机器（node）划分成 slots，任务 jobs 由精简的 tasks 来组成，并且和 slots 相匹配。task 运行时间通常很短，一台机器上可以同时运行多个 tasks，这样一来，Job 就可以在同一个机器（node）上读写数据，达到一个比较好的数据 Locaility。再次抱歉，由于这些框架都是各自开发的，在框架之间没法得到一个细粒度的资源共享，所以就比较难搞。

在这篇论文里面，Mesos 给所有的框架一个统一的访问集群资源的接口，然后自己在底层实现一个细粒度的跨框架资源共享方案。

这里面的主要问题是 Mesos 怎样去构建一个可扩展的高校系统，可以同时支持各种各样的计算框架，这里面比较屌的是还要支持还没有出现的未来的框架，Mesos 也要支持。这就延伸出来一些子问题，一是各个框架之间基于他们的编程模型，交互模式，任务依赖和数据存储有不同的资源调度需求，二是调度系统要能扩展到成千上万的节点，数以百万计的 tasks。最后，因为这些框架都依赖 Mesos，所以 Mesos 本身必须容错且高可用。

一个可选的方法是实现一个中央调度器，统计框架的需求，资源利用情况和组织规则，然后计算出一个调度方案。尽管这种方案可以实现在框架之间的最优化调度，但是不得不面临许多的挑战。首当其冲的就是复杂度，调度器需要提供一个可以有效表达的 API 来满足所有框架的需求，还要在线百万级的 task 优化问题，即使这种方案可行，这种程度的复杂性会给扩展性和可靠性带来巨大的负面影响。其次，新的框架和调度策略在不断的出现，我们不能明确的保障说可以满足所有未来出现的框架。再次，许多现有的框架实现了它们自己的复杂的调度算法，将框架已有的调度实现重构移植到全局的调度器上需要巨大的工作量。

所以！Mesos 另辟蹊径，将调度控制委托给框架自身。这是一个全新的抽象概念，叫做 resource offer，这是将资源打包给框架，框架再在集群上分配资源运行 task。Mesos 基于组织策略比说公平，来决定给框架分配多少资源，同时框架自己决定接受多少的资源同时运行什么样的 task。尽管这种去中心化的调度模型达不到全局的最优化方案，但是在实际中我们去发现它运行得非常棒棒哒，可以让框架近乎完美的达到数据 Locality。此外，resource offer 也足够简单，可以非常方便稳定的实现出来，同时也可以达到高度可扩展和稳定性。

Mesos 还有其他好处，即使你实际上只使用了一个框架，也可以使用 Mesos，或者你可以运营一个框架的不同版本，我们在雅虎和 Facebook 使用这个方案来区分生产和实验的集群，同时隔离掉生产和集群的负载，同时用来滚动升级 Hadoop。还有，Mesos 可以用来快速的开发和实验部署新的框架。这种可以在不同框架之间共享资源的能力释放了开发者构建和运行特定框架的工作，同时也比给所有程序员的所有问题领域都只提供一种方案更加的有效。在这种情况，不同的框架能够给不同领域的问题提供更好的支持。

我们实现 Mesos 只用了 1w 行的 c++ 代码，这个系统可以扩展到 5w 个虚拟节点，使用 zookeeper 来支持容错。为了评估 Mesos，我们移植了3个集群计算框架到上面，Hadoop，MPI 和 Torque 批调度器。为了验证我们特定的框架能比通用的一个框架提供更高的价值的设想，我们在 Mesos 之上创建了一个新的框架叫做 Spark，针对迭代数据型的 job 做了优化，特别是在多个并行任务中需要反复读取同一个数据集的情况，结果显示在迭代型的机器学习负载情况下获得了10倍的加速。

这篇文章的结构如下，第二部分介绍了 Mesos 针对的数据中心环境。第三部分展示了 Mesos 的架构。第四部分我们的分布式调度模型，并总结它的优势运行环境。第五部分介绍 Mesos 的实现。第六部分评估性能，相关工作在第七部分，最后总结是第八部分。

# 目标环境

